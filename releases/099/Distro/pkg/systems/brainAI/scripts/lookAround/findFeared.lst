c:/ZH099/pkg/systems/classes/include/classes.inc, Line 26
var settings := Classes_GetSettingsCfgElem( "Settings" );
0: decl global #0
1: "Settings"
2: 0L
3: makelocal
4: jmp userfunc @162
5: :=
6: #
c:/ZH099/pkg/utils/datafile/include/datafile.inc, Line 35
var DF_DEBUG_MODE	:= 0;
7: decl global #1
8: 0L
9: :=
10: #
C:\ZH099\pkg\systems\brainAI\scripts\lookAround\findFeared.src, Line 25
program BrainNerve( params )
include ":classes:classes";
11: get arg 'params'
var npc		:= params[1];
12: decl local #1
13: local #0
14: 1L
15: [] 1
16: :=
17: #
var nerve_name	:= params[2];
18: decl local #2
19: local #0
20: 2L
21: [] 1
22: :=
23: #
var nsettings	:= params[3];
24: decl local #3
25: local #0
26: 3L
27: [] 1
28: :=
29: #
var scripts	:= params[4];
30: decl local #4
31: local #0
32: 4L
33: [] 1
34: :=
35: #
params := 0; // Not needed anymore.
36: 0L
37: local0 := 
while( npc )
38: local #1
39: if false goto 84
if( !npc.opponent && !npc.master )
40: local #1
41: get member id 'opponent' (120)
42: !
43: local #1
44: get member id 'master' (63)
45: !
46: &&
47: if false goto 75
if( NPC_LoadWatchList( npc ).Size() < 1 )
48: local #1
49: makelocal
50: jmp userfunc @310
51: Call Method id size (#48, 0 params)
52: 1L
53: <
54: if false goto 62
return AI_EndNerve( npc, nerve_name );
55: local #1
56: local #2
57: 0L
58: makelocal
59: jmp userfunc @130
60: progend
61: goto74
if( !FindFearedOpponent( npc, nsettings, scripts ))
62: local #1
63: local #3
64: local #4
65: makelocal
66: jmp userfunc @206
67: if true goto 74
return AI_EndNerve( npc, nerve_name );
68: local #1
69: local #2
70: 0L
71: makelocal
72: jmp userfunc @130
73: progend
74: goto75
AI_ClearThoughts( npc, CLR_NERVE );
75: local #1
76: 2L
77: makelocal
78: jmp userfunc @88
79: #
Sleep(1);
80: 1L
81: Func(3,7): Sleep
82: #
83: goto38
return 1;
84: 1L
85: progend
86: leave block(5)
87: progend
c:/ZH099/pkg/systems/brainAI/include/npcCommands.inc, Line 45
function AI_ClearThoughts( npc, flags )
88: pop param 'flags'
89: pop param 'npc'
var brain	:= flags & CLR_BRAIN;
90: decl local #2
91: local #0
92: 1L
93: &
94: :=
95: #
var nerve	:= flags & CLR_NERVE;
96: decl local #3
97: local #0
98: 2L
99: &
100: :=
101: #
var both	:= flags & CLR_BOTH;
102: decl local #4
103: local #0
104: 3L
105: &
106: :=
107: #
if( both || brain )
108: local #4
109: local #2
110: ||
111: if false goto 118
brain := NPC.process;
112: local #1
113: get member id 'process' (64)
114: local2 := 
brain.clear_event_queue();
115: local #2
116: Call Method id clear_event_queue (#78, 0 params)
117: #
if( both || nerve )
118: local #4
119: local #3
120: ||
121: if false goto 128
nerve := GetProcess( GetPid() );
122: Func(3,4): GetPid
123: Func(3,1): GetProcess
124: local3 := 
nerve.clear_event_queue();
125: local #3
126: Call Method id clear_event_queue (#78, 0 params)
127: #
return 1;
128: 1L
129: return
c:/ZH099/pkg/systems/brainAI/include/npcCommands.inc, Line 64
function AI_EndNerve( npc, nerve_name, no_wake:=NOWAKE )
130: pop param 'no_wake'
131: pop param 'nerve_name'
132: pop param 'npc'
var ev		:= struct;
133: decl local #3
134: struct
135: :=
136: #
ev.+type	:= NPCEVENT_ENDNERVE;
137: local #3
138: "type"
139: .+
140: 10485775L
141: := #
ev.+name	:= nerve_name;
142: local #3
143: "name"
144: .+
145: local #1
146: := #
ev.+WakeUp	:= no_wake;
147: local #3
148: "WakeUp"
149: .+
150: local #0
151: := #
ev.+process	:= GetProcess( GetPid() );
152: local #3
153: "process"
154: .+
155: Func(3,4): GetPid
156: Func(3,1): GetProcess
157: := #
return SendEvent( npc, ev );
158: local #2
159: local #3
160: Func(2,3): SendEvent
161: return
c:/ZH099/pkg/systems/classes/include/settings.inc, Line 20
function Classes_GetSettingsCfgElem( elem_name, byref cfg_file:=0 )
162: pop param byref 'cfg_file'
163: pop param 'elem_name'
if( !cfg_file )
164: local #0
165: if true goto 169
cfg_file := Classes_GetSettingsCfgFile();
166: makelocal
167: jmp userfunc @190
168: local0 := 
var elem := cfg_file[elem_name];
169: decl local #2
170: local #0
171: local #1
172: [] 1
173: :=
174: #
if( elem.errortext )
175: local #2
176: get member 'errortext'
177: if false goto 188
SysLog( "Error::Classes_GetSettingsCfgElem() - Unable to find elem ["+elem_name
178: "Error::Classes_GetSettingsCfgElem() - Unable to find elem ["
179: local #1
180: +
181: "] ->"
182: +
183: local #2
184: get member 'errortext'
185: +
186: Func(3,0): SysLog
187: #
return elem;
188: local #2
189: return
c:/ZH099/pkg/systems/classes/include/settings.inc, Line 12
function Classes_GetSettingsCfgFile()
var cfg := ReadConfigFile( ":classes:settings" );
190: decl local #0
191: ":classes:settings"
192: Func(5,0): ReadConfigFile
193: :=
194: #
if( cfg.errortext )
195: local #0
196: get member 'errortext'
197: if false goto 204
SysLog( "Error::Classes_GetSettingsCfgFile() - Unable to open [:classes:setting
198: "Error::Classes_GetSettingsCfgFile() - Unable to open [:classes:settings.cfg] ->"
199: local #0
200: get member 'errortext'
201: +
202: Func(3,0): SysLog
203: #
return cfg;
204: local #0
205: return
C:\ZH099\pkg\systems\brainAI\scripts\lookAround\findFeared.src, Line 54
function FindFearedOpponent( npc, byref settings, byref scripts )
206: pop param byref 'scripts'
207: pop param byref 'settings'
208: pop param 'npc'
var run_list := array;
209: decl local #3
210: array
211: :=
212: #
foreach mobile in ( ListMobilesNearLocationEx( npc.x, npc.y, npc.z, CInt( setti
213: local #2
214: get member id 'x' (0)
215: local #2
216: get member id 'y' (1)
217: local #2
218: get member id 'z' (2)
219: local #1
220: "AreaSize"
221: [] 1
222: Func(0,2): CInt
223: 3L
224: local #2
225: get member id 'realm' (112)
226: Func(2,10): ListMobilesNearLocationEx
227: initforeach @257
SleepMS(2);
228: 2L
229: Func(3,2): Sleepms
230: #
if( !CheckLineOfSight( npc, mobile ))
231: local #2
232: local #4
233: Func(2,11): CheckLineOfSight
234: if true goto 237
continue;
235: goto257
236: goto253
elseif( !NPC_IsInWatchList( npc, mobile ))
237: local #2
238: local #4
239: makelocal
240: jmp userfunc @291
241: if true goto 244
continue;
242: goto257
243: goto253
elseif( mobile.hidden )
244: local #4
245: get member id 'hidden' (32)
246: if false goto 253
if( !DetectHidden( npc, mobile ))
247: local #2
248: local #4
249: makelocal
250: jmp userfunc @389
251: if true goto 253
continue;
252: goto257
run_list.Append( mobile );
253: local #3
254: local #4
255: Call Method id append (#52, 1 params)
256: #
257: stepforeach @228
258: leave block(3)
if( run_list.Size() > 0 )
259: local #3
260: Call Method id size (#48, 0 params)
261: 0L
262: >
263: if false goto 289
var feared_one := run_list.RandomEntry();
264: decl local #0
265: local #3
266: Call Method id randomentry (#101, 0 params)
267: :=
268: #
AI_Move( npc, feared_one.x, feared_one.y, feared_one.z, NEMOVE_AWAY, NEMOVE_WAL
269: local #2
270: local #4
271: get member id 'x' (0)
272: local #4
273: get member id 'y' (1)
274: local #4
275: get member id 'z' (2)
276: 2L
277: 1L
278: local #1
279: "AreaSize"
280: [] 1
281: Func(0,2): CInt
282: 0L
283: makelocal
284: jmp userfunc @327
285: #
return feared_one;
286: local #4
287: return
288: leave block(1)
return 0;
289: 0L
290: return
c:/ZH099/pkg/systems/brainAI/include/npcWatchList.inc, Line 70
function NPC_IsInWatchList( npc, mobile )
291: pop param 'mobile'
292: pop param 'npc'
if( mobile.IsA( POLCLASS_MOBILE ))
293: local #0
294: 3L
295: Call Method id isa (#0, 1 params)
296: if false goto 300
mobile := mobile.serial;
297: local #0
298: get member id 'serial' (6)
299: local0 := 
var watch_dict := NPC_LoadWatchList( npc );
300: decl local #2
301: local #1
302: makelocal
303: jmp userfunc @310
304: :=
305: #
return watch_dict.Exists( mobile );
306: local #2
307: local #0
308: Call Method id exists (#55, 1 params)
309: return
c:/ZH099/pkg/systems/brainAI/include/npcWatchList.inc, Line 23
function NPC_LoadWatchList( npc )
310: pop param 'npc'
var watch_dict := GetObjProperty( npc, "#WatchList" );
311: decl local #1
312: local #0
313: "#WatchList"
314: Func(2,2): GetObjProperty
315: :=
316: #
if( Lower( TypeOf( watch_dict )) != "dictionary" )
317: local #1
318: Func(0,1): TypeOf
319: Func(0,0): Lower
320: "dictionary"
321: <>
322: if false goto 325
watch_dict := dictionary;
323: dictionary
324: local1 := 
return watch_dict;
325: local #1
326: return
c:/ZH099/pkg/systems/brainAI/include/npcCommands.inc, Line 88
function AI_Move( npc, x, y, z, to_from:=NEMOVE_TOWARD, speed:=NEMOVE_RUN, loop
327: pop param 'no_wake'
328: pop param 'loop'
329: pop param 'speed'
330: pop param 'to_from'
331: pop param 'z'
332: pop param 'y'
333: pop param 'x'
334: pop param 'npc'
var ev		:= struct;
335: decl local #8
336: struct
337: :=
338: #
ev.+type	:= NPCEVENT_MOVE;
339: local #8
340: "type"
341: .+
342: 10485763L
343: := #
ev.+x		:= x;
344: local #8
345: "x"
346: .+
347: local #6
348: := #
ev.+y		:= y;
349: local #8
350: "y"
351: .+
352: local #5
353: := #
ev.+z		:= z;
354: local #8
355: "z"
356: .+
357: local #4
358: := #
ev.+direction	:= to_from;
359: local #8
360: "direction"
361: .+
362: local #3
363: := #
ev.+speed	:= speed;
364: local #8
365: "speed"
366: .+
367: local #2
368: := #
ev.+WakeUp	:= no_wake;
369: local #8
370: "WakeUp"
371: .+
372: local #0
373: := #
ev.+loop	:= loop;
374: local #8
375: "loop"
376: .+
377: local #1
378: := #
ev.+process	:= GetProcess( GetPid() );
379: local #8
380: "process"
381: .+
382: Func(3,4): GetPid
383: Func(3,1): GetProcess
384: := #
return SendEvent( npc, ev );
385: local #7
386: local #8
387: Func(2,3): SendEvent
388: return
c:/ZH099/pkg/skills/thief/detecthidden/include/detectHidden.inc, Line 12
function DetectHidden( mobile, hider )
389: pop param 'hider'
390: pop param 'mobile'
if( !hider.hidden )
391: local #0
392: get member id 'hidden' (32)
393: if true goto 396
return 1; //Already revealed.
394: 1L
395: return
var mobile_skill := AP_GetSkill( mobile, DETECTING_HIDDEN ),
396: decl local #2
397: local #1
398: "DetectingHidden"
399: makelocal
400: jmp userfunc @473
401: :=
402: #
403: decl local #3
404: local #0
405: "Hiding"
406: makelocal
407: jmp userfunc @473
408: :=
409: #
mobile_skill *= ClasseBonus( mobile, THIEF );
410: local #2
411: local #1
412: "IsThief"
413: makelocal
414: jmp userfunc @503
415: *=
416: #
hider_skill *= ClasseBonus( hider, THIEF );
417: local #3
418: local #0
419: "IsThief"
420: makelocal
421: jmp userfunc @503
422: *=
423: #
if( mobile.IsA( POLCLASS_NPC ))
424: local #1
425: 4L
426: Call Method id isa (#0, 1 params)
427: if false goto 436
if( !mobile_skill )
428: local #2
429: if true goto 432
return 0;
430: 0L
431: return
mobile_skill *= 2;
432: local #2
433: 2L
434: *=
435: #
var chance := CInt( mobile_skill - hider_skill );
436: decl local #4
437: local #2
438: local #3
439: -
440: Func(0,2): CInt
441: :=
442: #
if( chance < 0 )
443: local #4
444: 0L
445: <
446: if false goto 449
chance := 5;
447: 5L
448: local4 := 
if( RandomInt( 100 ) > chance && !mobile.multi )
449: 100L
450: Func(4,2): RandomInt
451: local #4
452: >
453: local #1
454: get member id 'multi' (12)
455: !
456: &&
457: if false goto 460
return 0;
458: 0L
459: return
hider.hidden := 0;
460: local #0
461: 0L
462: set member id 'hidden' (32) #
PrintTextAbovePrivate( hider, "You have been discovered!", hider );
463: local #0
464: "You have been discovered!"
465: local #0
466: 3L
467: 1000L
468: 0L
469: Func(2,9): PrintTextAbovePrivate
470: #
return 1;
471: 1L
472: return
c:/ZH099/pkg/systems/attributes/include/skills.inc, Line 8
function AP_GetSkill( who, skill_name )
473: pop param 'skill_name'
474: pop param 'who'
return AP_GetTrueSkill( who, skill_name )+AP_GetSkillMod( who, skill_name );
475: local #1
476: local #0
477: makelocal
478: jmp userfunc @494
479: local #1
480: local #0
481: makelocal
482: jmp userfunc @485
483: +
484: return
c:/ZH099/pkg/systems/attributes/include/skills.inc, Line 18
function AP_GetSkillMod( who, skill_name )
485: pop param 'skill_name'
486: pop param 'who'
return CDbl( GetAttributeTemporaryMod( who, skill_name )) / 10.0;
487: local #1
488: local #0
489: Func(7,1): GetAttributeTemporaryMod
490: Func(0,3): CDbl
491: 10LF
492: /
493: return
c:/ZH099/pkg/systems/attributes/include/skills.inc, Line 13
function AP_GetTrueSkill( who, skill_name )
494: pop param 'skill_name'
495: pop param 'who'
return CDbl( GetAttributeBaseValue( who, skill_name )) / 10.0;
496: local #1
497: local #0
498: Func(7,0): GetAttributeBaseValue
499: Func(0,3): CDbl
500: 10LF
501: /
502: return
c:/ZH099/pkg/systems/classes/include/classes.inc, Line 28
function ClasseBonus( mobile, classe )
503: pop param 'classe'
504: pop param 'mobile'
var level := CInt( GetObjProperty( mobile, classe ));
505: decl local #2
506: local #1
507: local #0
508: Func(2,2): GetObjProperty
509: Func(0,2): CInt
510: :=
511: #
if( level )
512: local #2
513: if false goto 523
return CDbl( settings.BonusLevel * level ) + 1;
514: global #0
515: get member 'BonusLevel'
516: local #2
517: *
518: Func(0,3): CDbl
519: 1L
520: +
521: return
522: goto525
return 1;
523: 1L
524: return
525: 0L
526: return
